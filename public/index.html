<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Fake E‑Commerce</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #0f9d58; color: #fff; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-weight: bold; }
    .container { padding: 20px; display: flex; gap: 20px; }
    .products { flex: 3; display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
    .product-card { border: 1px solid #ddd; border-radius: 4px; padding: 10px; display: flex; flex-direction: column; align-items: center; }
    .product-card img { width: 120px; height: 120px; object-fit: contain; margin-bottom: 8px; }
    .product-card h4 { font-size: 14px; margin: 5px 0; text-align: center; }
    .product-card p { margin: 4px 0; font-weight: bold; }
    .product-card button { margin-top: auto; padding: 5px 10px; background: #0f9d58; color: white; border: none; border-radius: 3px; cursor: pointer; }
    .cart { flex: 1; border-left: 1px solid #ddd; padding-left: 15px; }
    .cart h3 { margin-top: 0; }
    .cart-item { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 14px; }
    .checkout-btn { margin-top: 10px; width: 100%; padding: 8px; background: #ff9800; color: #fff; border: none; border-radius: 3px; cursor: pointer; }
    .message { margin-top: 10px; color: green; font-size: 14px; }
  </style>
</head>
<body>
  <header>
    <div class="logo">Grocery Clone</div>
    <div>Simple Fake E‑Commerce</div>
  </header>
  <div class="container">
    <div class="products" id="products"></div>
    <div class="cart">
      <h3>Cart</h3>
      <div id="cart-items"></div>
      <p><strong>Total: ₹<span id="cart-total">0</span></strong></p>
      <button class="checkout-btn" id="checkout-btn">Checkout</button>
      <div class="message" id="message"></div>
    </div>
  </div>
  <script>
    const productsContainer = document.getElementById('products');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartTotalSpan = document.getElementById('cart-total');
    const checkoutBtn = document.getElementById('checkout-btn');
    const messageDiv = document.getElementById('message');

    function loadProducts() {
      fetch('/api/products')
        .then(res => res.json())
        .then(products => {
          productsContainer.innerHTML = '';
          products.forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
              <img src="${p.image}" alt="${p.title}" />
              <h4>${p.title}</h4>
              <p>₹${p.price}</p>
              <small>${p.source}</small>
              <button>Add to Cart</button>
            `;
            const btn = card.querySelector('button');
            btn.addEventListener('click', () => addToCart(p));
            productsContainer.appendChild(card);
          });
        })
        .catch(err => {
          console.error(err);
          productsContainer.innerHTML = 'Failed to load products';
        });
    }

    function loadCart() {
      fetch('/api/cart')
        .then(res => res.json())
        .then(cart => {
          cartItemsContainer.innerHTML = '';
          let total = 0;
          cart.forEach(item => {
            total += item.price * item.quantity;
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
              <span>${item.title} x ${item.quantity}</span>
              <span>₹${(item.price * item.quantity).toFixed(2)}</span>
            `;
            cartItemsContainer.appendChild(div);
          });
          cartTotalSpan.textContent = total.toFixed(2);
        });
    }

    function addToCart(product) {
      fetch('/api/cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          id: product.id,
          title: product.title,
          price: Number(product.price)
        })
      })
      .then(res => res.json())
      .then(() => {
        loadCart();
      });
    }

    checkoutBtn.addEventListener('click', () => {
      fetch('/api/checkout', { method: 'POST' })
        .then(res => res.json())
        .then(data => {
          messageDiv.textContent = `${data.message} Order ID: ${data.orderId}, Total: ₹${data.total.toFixed(2)}`;
          loadCart();
        })
        .catch(err => {
          console.error(err);
          messageDiv.textContent = 'Checkout failed.';
        });
    });

    loadProducts();
    loadCart();
  </script>
</body>
</html>
